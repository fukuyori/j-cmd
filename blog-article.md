# Windows で cd を卒業する：高速ディレクトリジャンプ「j」を作った

## cd の不満

Windowsでコマンドライン作業をしていると、ディレクトリ移動が面倒だと感じることがあります。

```cmd
cd C:\Users\name\Documents\Projects\MyApp\src\components
```

長い。覚えられない。タブ補完を何度も押す。

Unix系には `z` や `autojump` といった便利なツールがありますが、Windowsではあまり選択肢がありません。そこで、Rustで自作しました。

## j とは

`j` は「一度行った場所には、キーワードだけで戻れる」ディレクトリジャンプツールです。

```cmd
j src          # "src" を含むディレクトリへ
j proj/comp    # "proj" と "comp" を両方含むパスへ
j              # ホームへ
```

履歴を自動で記録し、キーワードで検索してジャンプします。

## 特徴

### キーワードジャンプ

パスの一部を覚えていれば、それだけで移動できます。

```cmd
C:\> j rust
C:\work\rust>

C:\work\rust> j doc
C:\Users\name\Documents>
```

### ドライブを意識しない

Windowsでは複数ドライブを使うことが多いですが、`j` はドライブをまたいで検索します。

```cmd
C:\> j proj     # D:\Projects に移動
D:\Projects>
```

特定のドライブに絞りたい場合は：

```cmd
j d:proj        # D: ドライブ内の "proj" を検索
```

### Undo / Redo

「さっきいた場所に戻りたい」は日常茶飯事。

```cmd
j -             # 前のディレクトリへ (Undo)
j +             # 次のディレクトリへ (Redo)
```

### 履歴から直接選択

```cmd
j -l            # 履歴一覧を表示
j -l 10         # 10件表示
j -3            # 履歴の3番目に移動
```

## 使い分け

| やりたいこと | コマンド |
|-------------|---------|
| 明示的なパス移動 | `cd` |
| キーワードでジャンプ | `j keyword` |
| 前に戻る | `j -` |
| ホームへ | `j` |

`cd` を完全に置き換えるものではありません。明示的にパスを指定したいときは `cd` を使い、「あのフォルダに行きたい」というときに `j` を使います。

## インストール

Rust製なので、ビルドが必要です。

```cmd
cargo build --release
```

生成された `j.exe` と `j-init.cmd` を PATH の通ったフォルダに配置し、コマンドプロンプトの自動実行に登録します。

```cmd
reg add "HKCU\Software\Microsoft\Command Processor" /v AutoRun /t REG_SZ /d "C:\path\to\j-init.cmd" /f
```

PowerShellの場合は `$PROFILE` に関数を追加します。詳細はREADMEを参照してください。

## 技術的なポイント

### なぜ Rust か

- シングルバイナリで配布が楽
- 起動が速い（コマンドラインツールには重要）
- Windows API との相性が良い

### 履歴の管理

履歴は `%APPDATA%\j-cmd\state.json` に保存されます。最大1000件で、訪問回数と最終訪問日時でスコアリングし、古いエントリから削除されます。

### マッチングロジック

1. 現在のディレクトリからの相対パスを確認
2. 履歴から完全一致（ディレクトリ名）
3. 履歴から部分一致

最後のキーワードは必ずディレクトリ名と一致する必要があります。`j rust` で `C:\work\rust\src` にはマッチせず、`C:\work\rust` にマッチします。

## まとめ

`j` を使い始めてから、ディレクトリ移動のストレスがかなり減りました。

「あのフォルダどこだっけ」と考える時間が、`j` と数文字のキーワードで解決します。

ソースコードはGitHubで公開しています。Windows環境でコマンドライン作業をする方は、ぜひ試してみてください。

---

## コマンド一覧

| コマンド | 説明 |
|----------|------|
| `j` | ホームディレクトリへ |
| `j keyword` | キーワードに一致するディレクトリへ |
| `j ~path` | ホーム配下のパスへ |
| `j d:` | D: ドライブのルートへ |
| `j d:keyword` | D: ドライブ内を検索 |
| `j -` | 前のディレクトリへ (Undo) |
| `j +` | 次のディレクトリへ (Redo) |
| `j .` | 最後に訪問したディレクトリへ |
| `j -l` | 履歴一覧を表示 |
| `j -N` | 履歴のN番目に移動 |
| `j -c` | 現在地を履歴に記録 |
| `j -x` | 現在地を履歴から削除 |
| `j -xa` | 履歴を全消去 |
